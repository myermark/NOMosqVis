aed_total = sum(`Aedes sp._total`, na.rm=T),
aed_mean = mean(`Aedes sp._total`, na.rm=T),
total_mosq = sum(select_if(light[,4:length(light)], is.numeric)))
summ_light <- light %>%
group_by(Address) %>%
summarize(long = median(long),
lat = median(lat),
cul_total = sum(`Culex sp._total`, na.rm=T),
cul_mean = mean(`Culex sp._total`, na.rm=T),
aed_total = sum(`Aedes sp._total`, na.rm=T),
aed_mean = mean(`Aedes sp._total`, na.rm=T),
total_mosq = sum(select_if(light[,4:length(light)], is.numeric)))
#Get the New Orleans bounding box
height <- max(summ_light$lat) - min(summ_light$lat)
width <- max(summ_light$long) - min(summ_light$long)
borders <- c(bottom  = min(summ_light$lat)  - 3 * height,
top     = max(summ_light$lat)  + 3 * height,
left    = min(summ_light$long) - 0.3 * width,
right   = max(summ_light$long) + 0.3 * width)
newheight = borders[2] - borders[1]
newwidth = borders[4] - borders[3]
nola_stamen <- get_stamenmap(bbox = borders, zoom = 13, maptype = "terrain")
map <- ggmap(nola_stamen)
map + geom_point(data = summ_light, pch=21, stroke = 1, aes(x=long, y= lat), fill = "red", size = 2)  +
guides(size = F) +
labs(x = "Longitude", y = "Latitude") +
ggtitle("Rain Garden Monitoring Traps") +
theme(axis.title.x = element_text(color = "black", size = 14, face = "bold"),
axis.title.y = element_text(color = "black", size = 14, face = "bold"),
plot.title = element_text(size=20, face = "bold"))
#Get the New Orleans bounding box
height <- max(summ_light$lat) - min(summ_light$lat)
width <- max(summ_light$long) - min(summ_light$long)
borders <- c(bottom  = min(summ_light$lat)  - 0.3 * height,
top     = max(summ_light$lat)  + 0.3 * height,
left    = min(summ_light$long) - 0.3 * width,
right   = max(summ_light$long) + 0.3 * width)
newheight = borders[2] - borders[1]
newwidth = borders[4] - borders[3]
nola_stamen <- get_stamenmap(bbox = borders, zoom = 13, maptype = "terrain")
map <- ggmap(nola_stamen)
#Light traps with Culex
map + geom_point(data = summ_light, pch=21, stroke = 1, aes(x=long, y= lat), fill = "red", size = 2)  +
guides(size = F) +
labs(x = "Longitude", y = "Latitude") +
ggtitle("Rain Garden Monitoring Traps") +
theme(axis.title.x = element_text(color = "black", size = 14, face = "bold"),
axis.title.y = element_text(color = "black", size = 14, face = "bold"),
plot.title = element_text(size=20, face = "bold"))
#Line graphs of month to month abundance by species
light_sub <- light %>%
mutate(Week = week(Date),
`Culex quinquefasciatus` = `Culex quinquefasciatus_m` + `Culex quinquefasciatus_f`,
`Aedes aegypti` = `Aedes aegypti_m` + `Aedes aegypti_f`,
`Aedes albopictus` = `Aedes albopictus_m` + `Aedes albopictus_f`,
`Coquilletidia perturbans` = `Coquillettidia perturbans_m` + `Coquillettidia perturbans_f`,
`Culiseta spp.` = rowSums(light[grep("Culiseta", names(light))], na.rm = TRUE)) %>%
subset(Address, Date, Week, `Culex quinquefasciatus`, `Aedes aegypti`, `Aedes albopictus`, `Coquilletidia perturbans`,  `Culiseta spp.`)
#Line graphs of month to month abundance by species
light_sub <- light %>%
mutate(Week = week(Date),
`Culex quinquefasciatus` = `Culex quinquefasciatus_m` + `Culex quinquefasciatus_f`,
`Aedes aegypti` = `Aedes aegypti_m` + `Aedes aegypti_f`,
`Aedes albopictus` = `Aedes albopictus_m` + `Aedes albopictus_f`,
`Coquilletidia perturbans` = `Coquillettidia perturbans_m` + `Coquillettidia perturbans_f`,
`Culiseta spp.` = rowSums(light[grep("Culiseta", names(light))], na.rm = TRUE)) %>%
select(Address, Date, Week, `Culex quinquefasciatus`, `Aedes aegypti`, `Aedes albopictus`, `Coquilletidia perturbans`,  `Culiseta spp.`)
View(light_sub)
library(reshape2)
light_melt <- reshape2::melt(light_sub, id.var="Address")
View(light_melt)
rm(light_melt)
View(summ_light)
View(light_sub)
light_gather <- gather(light_sub, "Address", "n", 3:8)
View(light_gather)
light_gather <- gather(light_sub, "Address", "n", 4:8)
View(light_gather)
4:8
light_gather <- gather(light_sub, c("Address", "Date""), "n", 4:8)
light_gather <- gather(light_sub, c("Address", "Date"), "n", 4:8)
light_gather <- unite(light_sub, 4:8)
View(light_sub)
light_gather <- pivot_longer(data = light_sub, cols = 4:8, names_to = "Species", values_to = "N")
View(light_gather)
plot <- ggplot(data = light_gather, aes(x=Week, y = N))
plot + geom_line(aes(color = Species))
plot <- ggplot(data = filter(light_gather, Address = "Virgil 2"), aes(x=Week, y = N))
plot <- ggplot(data = filter(light_gather, Address == "Virgil 2"), aes(x=Week, y = N))
plot + geom_line(aes(color = Species))
plot + geom_line(aes(color = Species)) +
labs(x = "Week", y = "Number of Mosquitoes") +
ggtitle("Rain Garden Monitoring Traps")
for(address in (unique(light_gather$Address))) {
plot <- ggplot(data = filter(light_gather, Address == address), aes(x=Week, y = N))
plot + geom_line(aes(color = Species)) +
labs(x = "Week", y = "Number of Mosquitoes") +
ggtitle(address)
}
(unique(light_gather$Address))
address = "Virgil 2"
plot <- ggplot(data = filter(light_gather, Address == address), aes(x=Week, y = N))
plot + geom_line(aes(color = Species)) +
labs(x = "Week", y = "Number of Mosquitoes") +
ggtitle(address)
for(address in (unique(light_gather$Address))) {
plot_name = paste0(address,"_2019Mosquito.tiff")
tiff(filename=paste0("Rain Gardens/Plots/", plot_name), width = 5, height = 4, units = "in", res = 90, compression = "lzw", type = "cairo")
plot <- ggplot(data = filter(light_gather, Address == address), aes(x=Week, y = N))
plot + geom_line(aes(color = Species)) +
labs(x = "Week", y = "Number of Mosquitoes") +
ggtitle(address)
dev.off()
}
for(address in (unique(light_gather$Address))) {
plot_name = paste0(address,"_2019Mosquito.tiff")
tiff(filename=paste0("Rain Gardens/Plots/", plot_name), width = 5, height = 4, units = "in", res = 90, compression = "lzw", type = "cairo")
plot <- ggplot(data = filter(light_gather, Address == address), aes(x=Week, y = N)) +
geom_line(aes(color = Species)) +
labs(x = "Week", y = "Number of Mosquitoes") +
ggtitle(address)
print(plot)
dev.off()
}
map + geom_point(data = summ_light, pch=21, stroke = 1, aes(x=long, y= lat), fill = "red", size = 2)  +
guides(size = F) +
labs(x = "Longitude", y = "Latitude") +
ggtitle("Rain Garden Monitoring Traps") +
geom_text(data = traps, aes(x=long, y=lat, label = Address), nudge_x = 0.001, nudge_y = 0.005, size = 2) +
theme(axis.title.x = element_text(color = "black", size = 14, face = "bold"),
axis.title.y = element_text(color = "black", size = 14, face = "bold"),
plot.title = element_text(size=20, face = "bold"))
map + geom_point(data = summ_light, pch=21, stroke = 1, aes(x=long, y= lat), fill = "red", size = 2)  +
guides(size = F) +
labs(x = "Longitude", y = "Latitude") +
ggtitle("Rain Garden Monitoring Traps") +
geom_text(data = summ_light, aes(x=long, y=lat, label = Address), nudge_x = 0.001, nudge_y = 0.005, size = 2) +
theme(axis.title.x = element_text(color = "black", size = 14, face = "bold"),
axis.title.y = element_text(color = "black", size = 14, face = "bold"),
plot.title = element_text(size=20, face = "bold"))
map + geom_point(data = summ_light, pch=21, stroke = 1, aes(x=long, y= lat), fill = "red", size = 2)  +
guides(size = F) +
labs(x = "Longitude", y = "Latitude") +
ggtitle("Rain Garden Monitoring Traps") +
geom_text(data = summ_light, aes(x=long, y=lat, label = Address), nudge_x = 0.001, nudge_y = 0.001, size = 2) +
theme(axis.title.x = element_text(color = "black", size = 14, face = "bold"),
axis.title.y = element_text(color = "black", size = 14, face = "bold"),
plot.title = element_text(size=20, face = "bold"))
map + geom_point(data = summ_light, pch=21, stroke = 1, aes(x=long, y= lat), fill = "red", size = 2)  +
guides(size = F) +
labs(x = "Longitude", y = "Latitude") +
ggtitle("Rain Garden Monitoring Traps") +
geom_text(data = summ_light, aes(x=long, y=lat, label = Address), nudge_x = 0.001, nudge_y = 0.001, size = 3, face = "bold") +
theme(axis.title.x = element_text(color = "black", size = 14, face = "bold"),
axis.title.y = element_text(color = "black", size = 14, face = "bold"),
plot.title = element_text(size=20, face = "bold"))
map + geom_point(data = summ_light, pch=21, stroke = 1, aes(x=long, y= lat), fill = "red", size = 2)  +
guides(size = F) +
labs(x = "Longitude", y = "Latitude") +
ggtitle("Rain Garden Monitoring Traps") +
geom_text(data = summ_light, aes(x=long, y=lat, label = Address), nudge_x = 0.001, nudge_y = 0.0015, size = 3) +
theme(axis.title.x = element_text(color = "black", size = 14, face = "bold"),
axis.title.y = element_text(color = "black", size = 14, face = "bold"),
plot.title = element_text(size=20, face = "bold"))
tiff(filename="Rain Gardens/Plots/RainGardenMap.tiff", width = 5, height = 4, units = "in", res = 90, compression = "lzw", type = "cairo")
map + geom_point(data = summ_light, pch=21, stroke = 1, aes(x=long, y= lat), fill = "red", size = 2)  +
guides(size = F) +
labs(x = "Longitude", y = "Latitude") +
ggtitle("Rain Garden Monitoring Traps") +
geom_text(data = summ_light, aes(x=long, y=lat, label = Address), nudge_x = 0.001, nudge_y = 0.0015, size = 3) +
theme(axis.title.x = element_text(color = "black", size = 14, face = "bold"),
axis.title.y = element_text(color = "black", size = 14, face = "bold"),
plot.title = element_text(size=20, face = "bold"))
dev.off()
tiff(filename="Rain Gardens/Plots/RainGardenMap.tiff", width = 10, height = 8, units = "in", res = 90, compression = "lzw", type = "cairo")
map + geom_point(data = summ_light, pch=21, stroke = 1, aes(x=long, y= lat), fill = "red", size = 2)  +
guides(size = F) +
labs(x = "Longitude", y = "Latitude") +
ggtitle("Rain Garden Monitoring Traps") +
geom_text(data = summ_light, aes(x=long, y=lat, label = Address), nudge_x = 0.001, nudge_y = 0.0015, size = 3) +
theme(axis.title.x = element_text(color = "black", size = 14, face = "bold"),
axis.title.y = element_text(color = "black", size = 14, face = "bold"),
plot.title = element_text(size=20, face = "bold"))
dev.off()
for(address in (unique(light_gather$Address))) {
plot_name = paste0(address,"_2019Mosquito.tiff")
tiff(filename=paste0("Rain Gardens/Plots/", plot_name), width = 5, height = 4, units = "in", res = 90, compression = "lzw", type = "cairo")
plot <- ggplot(data = filter(light_gather, Address == address), aes(x=Week, y = N)) +
geom_line(aes(color = Species)) +
labs(x = "Week", y = "Number of Mosquitoes") +
ggtitle(address) +
theme(panel.background = element_blank())
print(plot)
dev.off()
}
for(address in (unique(light_gather$Address))) {
plot_name = paste0(address,"_2019Mosquito.tiff")
tiff(filename=paste0("Rain Gardens/Plots/", plot_name), width = 10, height = 8, units = "in", res = 90, compression = "lzw", type = "cairo")
plot <- ggplot(data = filter(light_gather, Address == address), aes(x=Week, y = N)) +
geom_line(aes(color = Species)) +
labs(x = "Week", y = "Number of Mosquitoes") +
ggtitle(address) +
theme(panel.background = element_blank())
print(plot)
dev.off()
}
for(address in (unique(light_gather$Address))) {
plot_name = paste0(address,"_2019Mosquito.tiff")
tiff(filename=paste0("Rain Gardens/Plots/", plot_name), width = 6, height = 5, units = "in", res = 150, compression = "lzw", type = "cairo")
plot <- ggplot(data = filter(light_gather, Address == address), aes(x=Week, y = N)) +
geom_line(aes(color = Species)) +
labs(x = "Week", y = "Number of Mosquitoes") +
ggtitle(address) +
theme(panel.background = element_blank())
print(plot)
dev.off()
}
for(address in (unique(light_gather$Address))) {
plot_name = paste0(address,"_2019Mosquito.tiff")
tiff(filename=paste0("Rain Gardens/Plots/", plot_name), width = 6, height = 5, units = "in", res = 150, compression = "lzw", type = "cairo")
plot <- ggplot(data = filter(light_gather, Address == address), aes(x=Week, y = N)) +
geom_line(aes(color = Species)) +
labs(x = "Week", y = "Number of Mosquitoes") +
ggtitle(address) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"))
print(plot)
dev.off()
}
unique(summ_light$Address)
map + geom_point(data = summ_light, pch=21, stroke = 1, aes(x=long, y= lat), fill = "red", size = 2)  +
guides(size = F) +
labs(x = "Longitude", y = "Latitude") +
ggtitle("Rain Garden Monitoring Traps") +
geom_text(data = filter(summ_light, Address != c("1254 Mirabeau [B]", "1254 Mirabeau [C]", "1254 Mirabeau [D]", "Virgil 2","Virgil 3","Virgil 4","Virgil 5","Virgil 6","Virgil 7"))
,aes(x=long, y=lat, label = Address), nudge_x = 0.001, nudge_y = 0.0015, size = 3) +
theme(axis.title.x = element_text(color = "black", size = 14, face = "bold"),
axis.title.y = element_text(color = "black", size = 14, face = "bold"),
plot.title = element_text(size=20, face = "bold"))
filter(summ_light, Address != c("1254 Mirabeau [B]", "1254 Mirabeau [C]", "1254 Mirabeau [D]", "Virgil 2","Virgil 3","Virgil 4","Virgil 5","Virgil 6","Virgil 7"))
filter(summ_light, Address !%in% c("1254 Mirabeau [B]", "1254 Mirabeau [C]", "1254 Mirabeau [D]", "Virgil 2","Virgil 3","Virgil 4","Virgil 5","Virgil 6","Virgil 7"))
filter(summ_light, !(Address %in% c("1254 Mirabeau [B]", "1254 Mirabeau [C]", "1254 Mirabeau [D]", "Virgil 2","Virgil 3","Virgil 4","Virgil 5","Virgil 6","Virgil 7")))
m
map + geom_point(data = summ_light, pch=21, stroke = 1, aes(x=long, y= lat), fill = "red", size = 2)  +
guides(size = F) +
labs(x = "Longitude", y = "Latitude") +
ggtitle("Rain Garden Monitoring Traps") +
geom_text(data = filter(summ_light, !(Address %in% c("1254 Mirabeau [B]", "1254 Mirabeau [C]", "1254 Mirabeau [D]", "Virgil 2","Virgil 3","Virgil 4","Virgil 5","Virgil 6","Virgil 7")))
,aes(x=long, y=lat, label = Address), nudge_x = 0.001, nudge_y = 0.0015, size = 3) +
theme(axis.title.x = element_text(color = "black", size = 14, face = "bold"),
axis.title.y = element_text(color = "black", size = 14, face = "bold"),
plot.title = element_text(size=20, face = "bold"))
tiff(filename="Rain Gardens/Plots/RainGardenMap.tiff", width = 10, height = 8, units = "in", res = 90, compression = "lzw", type = "cairo")
map + geom_point(data = summ_light, pch=21, stroke = 1, aes(x=long, y= lat), fill = "red", size = 2)  +
guides(size = F) +
labs(x = "Longitude", y = "Latitude") +
ggtitle("Rain Garden Monitoring Traps") +
geom_text(data = filter(summ_light, !(Address %in% c("1254 Mirabeau [B]", "1254 Mirabeau [C]", "1254 Mirabeau [D]", "Virgil 2","Virgil 3","Virgil 4","Virgil 5","Virgil 6","Virgil 7")))
,aes(x=long, y=lat, label = Address), nudge_x = 0.001, nudge_y = 0.0015, size = 3) +
theme(axis.title.x = element_text(color = "black", size = 14, face = "bold"),
axis.title.y = element_text(color = "black", size = 14, face = "bold"),
plot.title = element_text(size=20, face = "bold"))
dev.off()
setwd("~/Documents/Mosquito Surveillance")
####---
# Title: RainGarden.R
#
# Author: Mark Myer
#
# Date: 2/10/2019
#
# Purpose: To format and summarize data from rain garden surveillance with CDC lights for 2019
#
# R version 3.6.1 Action of the Toes
####---
library(readr)
library(readxl)
library(ggplot2)
library(tidyr)
library(dplyr)
library(lubridate)
library(rgdal)
library(ggmap)
library(RColorBrewer)
library(viridisLite)
library(reshape2)
#Rain garden traps
light <- read_excel("Rain Gardens/2019_RainGarden_CDCLT.xlsx", sheet = 1)
<-
#Rain garden traps
light <- read_excel("Rain Gardens/2019_RainGarden_CDCLT.xlsx", sheet = 1)
light <- light %>%
filter(!is.na(`Culex quinquefasciatus_f`)) %>%
mutate(Date = as.Date(Date)) %>%
mutate_at(c(names(light)[6:(ncol(light)-1)]), as.integer)
warnings()
View(light)
light <- light %>%
filter(!is.na(`Culex quinquefasciatus_f`)) %>%
mutate(Date = as.Date(Date)) %>%
mutate_at(c(names(light)[6:(ncol(light)-1)]), as.integer)
View(light)
#Graph the types of mosquitoes found in traps
sums <- light %>%
summarize_if(is.numeric, sum, na.rm= TRUE)
sums <- sums[,3:length(sums)]
sums <- arrange(sums)
View(sums)
total_mosq <- rowSums(sums)
#Make a pie chart
lbls = c("Cx. salinarius","Ae. vexans","An. crucians","Cx. restuans", "Cx. nigripalpus","Cx. quinquefasciatus","Other")
slices = c(7187, 3842, 700, 550, 497, 338, rowSums(select(sums, -c(`Culex quinquefasciatus_m`,
`Culex quinquefasciatus_f`,
`Aedes vexans_m`,
`Aedes vexans_f`,
`Anopheles crucians_m`,
`Anopheles crucians_f`,
`Culex nigripalpus_m`,
`Culex nigripalpus_f`,
`Culex restuans_m`,
`Culex restuans_f`,
`Culex salinarius_m`,
`Culex salinarius_f`))))
pct <- round(slices/sum(slices)*100)
lbls <- paste(lbls, pct) # add percents to labels
lbls <- paste(lbls,"%",sep="") # ad % to labels
pie(slices,labels = lbls, col=rainbow(length(lbls)),
main="Mosquito Species Found in Rain Gardens")
sums$`Culex quinquefasciatus_m`
sums$`Culex quinquefasciatus_m`+sums$`Culex quinquefasciatus_f`
lbls = c("Cx. salinarius","Ae. vexans","An. crucians","Cx. restuans", "Cx. nigripalpus","Cx. quinquefasciatus","Other")
slices = c(sums$`Culex salinarius_m` + sums$`Culex salinarius_f`,
sums$`Aedes vexans_m` + sums$`Aedes vexans_f`,
sums$`Anopheles crucians_m` + sums$`Anopheles crucians_f`,
sums$`Culex restuans_m` + sums$`Culex restuans_f`,
sums$`Culex nigripalpus_m` + sums$`Culex nigripalpus_f`,
sums$`Culex quinquefasciatus_m` + sums$`Culex quinquefasciatus_f`,
rowSums(select(sums, -c(
`Culex quinquefasciatus_m`,
`Culex quinquefasciatus_f`,
`Aedes vexans_m`,
`Aedes vexans_f`,
`Anopheles crucians_m`,
`Anopheles crucians_f`,
`Culex nigripalpus_m`,
`Culex nigripalpus_f`,
`Culex restuans_m`,
`Culex restuans_f`,
`Culex salinarius_m`,
`Culex salinarius_f`))))
pct <- round(slices/sum(slices)*100)
lbls <- paste(lbls, pct) # add percents to labels
lbls <- paste(lbls,"%",sep="") # ad % to labels
pie(slices,labels = lbls, col=rainbow(length(lbls)),
main="Mosquito Species Found in Rain Gardens")
#Line graphs of month to month abundance by species
light_sub <- light %>%
mutate(Week = week(Date),
`Culex quinquefasciatus` = `Culex quinquefasciatus_m` + `Culex quinquefasciatus_f`,
`Aedes aegypti` = `Aedes aegypti_m` + `Aedes aegypti_f`,
`Aedes albopictus` = `Aedes albopictus_m` + `Aedes albopictus_f`,
`Coquilletidia perturbans` = `Coquillettidia perturbans_m` + `Coquillettidia perturbans_f`,
`Culiseta spp.` = rowSums(light[grep("Culiseta", names(light))], na.rm = TRUE)) %>%
select(Address, Date, Week, `Culex quinquefasciatus`, `Aedes aegypti`, `Aedes albopictus`, `Coquilletidia perturbans`,  `Culiseta spp.`)
light_gather <- pivot_longer(data = light_sub, cols = 4:8, names_to = "Species", values_to = "N")
View(light_sub)
View(light)
#Total the mosquito species for each address, then produce a report listing the top ten and the number captured
light_report <- light %>%
mutate(`Culex quinquefasciatus` = `Culex quinquefasciatus_m` + `Culex quinquefasciatus_f`,
`Aedes aegypti` = `Aedes aegypti_m` + `Aedes aegypti_f`,
`Aedes albopictus` = `Aedes albopictus_m` + `Aedes albopictus_f`,
`Aedes vexans` = `Aedes vexans_m` + `Aedes vexans_f`,
`Anopheles artropus` = `Anopheles artropus_m` + `Anopheles artropus_f`,
`Anopheles bradleyi` = `Anopheles bradleyi_m` + `Anopheles bradleyi_f`,
`Anopheles crucians` = `Anopheles crucians_m` + `Anopheles crucians_f`,
`Anopheles perplexans` = `Anopheles perplexans_m` + `Anopheles perplexans_f`,
`Anopheles punctipennis` = `Anopheles punctipennis_m` + `Anopheles punctipennis_f`,
`Anopheles quadrimaculatus` = `Anopheles quadrimaculatus_m` + `Anopheles quadrimaculatus_f`,
`Anopheles walkeri` = `Anopheles walkeri_m` + `Anopheles walkeri_f`,
`Coquilletidia perturbans` = `Coquillettidia perturbans_m` + `Coquillettidia perturbans_f`,
`Culex coronator` = `Culex coronator_m` + `Culex coronator_f`,
`Culex erraticus` = `Culex erraticus_m` + `Culex erraticus_f`,
`Culex nigripalpus` = `Culex nigripalpus_m` + `Culex nigripalpus_f`,
`Culex restuans` = `Culex restuans_m` + `Culex restuans_f`,
`Culex salinarius` = `Culex salinarius_m` + `Culex salinarius_f`,
`Culex tarsalis` = `Culex tarsalis_m` + `Culex tarsalis_f`,
`Culex territans` = `Culex territans_m` + `Culex territans_f`,
`Culiseta inornata` = `Culiseta inornata_m` + `Culiseta inornata_f`,
`Culiseta melanura` = `Culiseta melanura_m` + `Culiseta melanura_f`,
`Mansonia dyari` = `Mansonia dyari_m` + `Mansonia dyari_f`,
`Mansonia titillans` = `Mansonia titillans_m` + `Mansonia titillans_f`,
`Aedes atlanticus` = `Aedes atlanticus_m` + `Aedes atlanticus_f`,
`Aedes canadensis` = `Aedes canadensis_m` + `Aedes canadensis_f`,
`Aedes dupreei` = `Aedes dupreei_m` + `Aedes dupreei_f`,
`Aedes infirmatus` = `Aedes infirmatus_m` + `Aedes infirmatus_f`,
`Aedes fulvus pallens` = `Aedes fulvus pallens_m` + `Aedes fulvus pallens_f`,
`Aedes canadensis mathesoni` = `Aedes canadensis mathesoni_m` + `Aedes canadensis mathesoni_f`,
`` = `` + ``,
`` = `` + ``,
`` = `` + ``,
`` = `` + ``,
`` = `` + ``,
`` = `` + ``,
`` = `` + ``,
`` = `` + ``,
`` = `` + ``,
`` = `` + ``,
`` = `` + ``,
`` = `` + ``,
`` = `` + ``,
`Culiseta spp.` = rowSums(light[grep("Culiseta", names(light))], na.rm = TRUE)) %>%
select(Address, Date, Week, `Culex quinquefasciatus`, `Aedes aegypti`, `Aedes albopictus`, `Coquilletidia perturbans`,  `Culiseta spp.`)
library(readr)
library(readxl)
library(ggplot2)
library(tidyr)
library(dplyr)
library(lubridate)
library(rgdal)
library(ggmap)
library(RColorBrewer)
library(viridisLite)
library(emoGG)
#BG Sentinel traps
bg <- read_excel("2020/BG Sentinel/Mosquito ID sheet_for analysis_BG_Sentinel_2020.xls")
bg <- bg %>%
mutate(Date = as.Date(Date)) %>%
mutate_at(c(names(bg)[7:(ncol(bg)-1)]), as.integer) #%>%
bg <- bg %>% mutate(`Culex sp._total` = rowSums(.[grep("Culex", names(.))], na.rm = TRUE), `Aedes sp._total` = rowSums(.[grep("Aedes", names(.))], na.rm = TRUE))
View(bg)
#Subset to only the most recent week
bg_subset <- bg %>% filter(week(Date) == (max(week(Date))))
View(bg_subset)
#Summarize by trap
#Custom function for the most frequently appearing string
calculate_mode <- function(x) {
uniqx <- unique(na.omit(x))
uniqx[which.max(tabulate(match(x, uniqx)))]
}
summ_bg <- bg_subset %>%
group_by(FID) %>%
summarize(address = calculate_mode(Address),
long = median(Long),
lat = median(Lat),
cul_total = sum(`Culex sp._total`, na.rm=T),
cul_mean = mean(`Culex sp._total`, na.rm=T),
aed_total = sum(`Aedes sp._total`, na.rm=T),
aed_mean = mean(`Aedes sp._total`, na.rm=T)) %>%
na.omit() #Get rid of superfluous NA row
Import data
#Gravid traps
grav <- read_excel("2020/Gravid/2020Gravid and pools_new.xlsx", sheet = 1)
grav <- grav %>%
mutate(Date = as.Date(Date)) %>%
mutate_at(c(names(grav)[9:(ncol(grav)-1)]), as.integer) #Errors are OK, it's just warning that the "." were turned into NAs
grav <- mutate(grav, `Culex sp._total` = rowSums(grav[grep("Culex", names(grav))], na.rm = TRUE), `Aedes sp._total` = rowSums(grav[grep("Aedes", names(grav))], na.rm = TRUE))
#Subset to only the most recent week
grav_subset <- grav %>% filter(week(Date) == max(week(Date)))
View(grav_subset)
summ_grav <- grav_subset %>%
group_by(FID) %>%
summarize(address = calculate_mode(Address),
long = median(Long),
lat = median(Lat),
cul_total = sum(`Culex sp._total`, na.rm=T), #In case there are more than one observation per week, this calculate the total
cul_mean = mean(`Culex sp._total`, na.rm=T),
aed_total = sum(`Aedes sp._total`, na.rm=T),
aed_mean = mean(`Aedes sp._total`, na.rm=T))
#Visualize using ggmaps
#Get the New Orleans bounding box
height <- max(summ_grav$lat) - min(summ_grav$lat)
width <- max(summ_grav$long) - min(summ_grav$long)
borders <- c(bottom  = min(summ_grav$lat)  - 0.3 * height,
top     = max(summ_grav$lat)  + 0.3 * height,
left    = min(summ_grav$long) - 0.3 * width,
right   = max(summ_grav$long) + 0.3 * width)
newheight = borders[2] - borders[1]
newwidth = borders[4] - borders[3]
nola_stamen <- get_stamenmap(bbox = borders, zoom = 11, maptype = "terrain")
map <- ggmap(nola_stamen)
#BG traps with Aedes
tiff(filename = "./2020/BG Sentinel/Maps/Aedes/031120_BG_Aedes_R.tiff", height = 8, width = 9, units = "in", res = 120, compression = "lzw", type="cairo")
map + geom_point(data = summ_bg, pch=21, stroke = 1, aes(x=long, y= lat, fill = aed_total), size = 3)  +
scale_fill_gradient(name= expression(italic("Aedes")~"collected"), low = "green", high = "red", limits = c(0, max(bg$`Aedes sp._total`, na.rm=T))) +
guides(size = F) +
labs(x = "Longitude", y = "Latitude") +
ggtitle("03/11/2020 BG Sentinel Traps") +
theme(axis.title.x = element_text(color = "black", size = 14, face = "bold"),
axis.title.y = element_text(color = "black", size = 14, face = "bold"),
plot.title = element_text(size=20, face = "bold"))
dev.off()
#BG traps with Culex
tiff(filename = "./2020/BG Sentinel/Maps/Culex/031120_BG_Culex_R.tiff", height = 8, width = 9, units = "in", res = 120, compression = "lzw", type="cairo")
map + geom_point(data = summ_bg, pch=21, stroke = 1, aes(x=long, y= lat, fill = cul_total), size = 3)  +
scale_fill_gradient(name= expression(italic("Culex")~"collected"), low = "green", high = "red", limits = c(0, max(bg$`Culex sp._total`, na.rm=T))) +
guides(size = F) +
labs(x = "Longitude", y = "Latitude") +
ggtitle("03/11/2020 BG Sentinel Traps") +
theme(axis.title.x = element_text(color = "black", size = 14, face = "bold"),
axis.title.y = element_text(color = "black", size = 14, face = "bold"),
plot.title = element_text(size=20, face = "bold"))
dev.off()
exp(0.17)
logit2prob <- function(logit){
odds <- exp(logit)
prob <- odds / (1 + odds)
return(prob)
}
logit2prob(0.17)
logit2prob(2.7)
exp(2.7)
exp(-0.23)
